---
title: Development
description: Contributing to and developing bbkt.
---

import { Tabs, TabItem } from '@astrojs/starlight/components';

This guide covers setting up a development environment and contributing to `bbkt`.

## Prerequisites

- **Go 1.25+**: Required for building
- **mise** (recommended): For tool management
- **Git**: For version control

## Getting Started

### Clone the Repository

```bash
git clone https://github.com/zach-snell/bbkt.git
cd bbkt
```

### Install Dependencies

<Tabs>
  <TabItem label="With mise">
    ```bash
    mise install
    ```
    This installs Go and development tools automatically.
  </TabItem>
  <TabItem label="Manual">
    ```bash
    # Install Go 1.25+
    # Then install dev tools:
    go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest
    ```
  </TabItem>
</Tabs>

### Build

```bash
mise run build
# or
go build -o bin/bbkt ./cmd/bbkt
```

### Run Tests

```bash
mise run check
# or
go test -race -cover ./...
```

## Project Structure

```
bbkt/
├── cmd/
│   ├── bbkt/                # Main CLI entrypoint
│   └── cli/                 # CLI subcommands (auth, profile, repos, etc.)
├── internal/
│   ├── bitbucket/           # Core API Client (HTTP requests, structs)
│   ├── mcp/                 # MCP Server and Multiplexed Handlers
│   │   ├── server.go        # MCP server setup, tool registration
│   │   ├── workspaces.go    # manage_workspaces handler logic 
│   │   ├── pipelines.go     # manage_pipelines handler logic
│   │   └── ...              # Other unified tools
│   ├── cli/                 # Interactive CLI wizards and formatting
│   └── keybox/              # Multi-profile keystore
├── docs/                    # Documentation site
├── .mise.toml               # mise configuration
└── README.md
```

## Development Tasks

Available mise tasks:

| Task | Description |
|------|-------------|
| `mise run build` | Build the binary |
| `mise run install` | Install binary to ~/.local/bin |
| `mise run check` | Run tests and linter |
| `mise run clean` | Remove build artifacts |

## Adding or Modifying a Tool

We use a "multiplexed" MCP pattern to avoid LLM tool limits. Instead of making an individual tool like `create_pull_request`, we group all PR operations into a single `manage_pull_requests` tool driven by an `action` enum.

### 1. Implement the API logic
Add the functionality to `internal/bitbucket/` communicating with the Bitbucket API:

```go
// internal/bitbucket/feature.go
type DoFeatureArgs struct { /* ... */ }

func (c *Client) DoFeature(args DoFeatureArgs) (Result, error) {
    // Make API HTTP Request
}
```

### 2. Update the MCP Handler
Locate the relevant domain in `internal/mcp/` (e.g. `internal/mcp/repos.go`) and update the arguments and handler logic:

```go
// Add the new action enum
type ManageFeatureArgs struct {
    Action string `json:"action" jsonschema:"Action: 'list', 'do-feature'"`
    // ...
}

func ManageFeatureHandler(c *bitbucket.Client) func(...) {
    return func(ctx context.Context, req *mcp.CallToolRequest, args ManageFeatureArgs) (*mcp.CallToolResult, any, error) {
        switch args.Action {
        case "do-feature":
            // Call into bitbucket.Client here
            result, err := c.DoFeature(...)
        }
    }
}
```

### 3. Register Tool in server.go
If this is an entirely new domain (e.g., Snippets), you'll need to define it in `internal/mcp/server.go`:

```go
addTool(s,
    mcp.NewTool("manage_snippets",
        mcp.WithDescription("Unified tool for snippet operations"),
        mcp.WithString("action",
		    mcp.Required(),
		    mcp.Description("Action to perform: 'list', 'get'"),
		    mcp.Enum("list", "get"),
	    ),
        // ...
    ),
    ManageSnippetsHandler(c),
)
```


### 3. Write Tests

```go
// internal/bitbucket/myfeature_test.go

package vault

import (
    "testing"
)

func TestMyNewTool(t *testing.T) {
    v := setupTestVault(t)
    
    // Test normal case
    result, err := v.doSomething("input")
    if err != nil {
        t.Fatalf("unexpected error: %v", err)
    }
    
    if result != expected {
        t.Errorf("got %v, want %v", result, expected)
    }
}
```

### 4. Update Documentation

Add documentation in `docs/src/content/docs/tools/`.

## Testing

### Unit Tests

```bash
go test ./internal/bitbucket/... -v
```

### With Coverage

```bash
go test -cover -coverprofile=coverage.out ./...
go tool cover -html=coverage.out
```

### Fuzz Testing

```bash
# Run all fuzz tests (10s each)
mise run fuzz

# Run specific fuzz test longer
FUZZ_NAME=ParseTask FUZZ_TIME=60s mise run fuzz:one
```

### Integration Testing

Test against a real vault:

```bash
# Create test vault
mkdir -p test-vault/daily test-vault/templates
echo "# Test" > test-vault/test.md

# Run server
mise run dev
```

## Code Style

### Formatting

```bash
gofmt -w .
```

### Linting

```bash
mise run lint
```

Linting checks:
- Code style
- Error handling
- Unused code
- Security issues

### Pre-commit Checks

Run before committing:

```bash
mise run check
```

## Documentation

### Local Development

```bash
cd docs
pnpm install
pnpm dev
```

### Building

```bash
mise run docs:build
```

### Adding Pages

1. Create `.mdx` file in appropriate directory
2. Update `astro.config.mjs` sidebar if needed
3. Use Starlight components for rich content

## Release Process

### Version Bump

1. Update version in `internal/server/server.go`
2. Update CHANGELOG.md
3. Commit: `git commit -m "Release vX.Y.Z"`
4. Tag: `git tag vX.Y.Z`
5. Push: `git push origin main --tags`

### CI/CD

GitHub Actions handles:
- Running tests on PR
- Building binaries on release
- Publishing to GitHub Releases
- Deploying documentation

## Contributing

### Pull Request Process

1. Fork the repository
2. Create a feature branch
3. Make changes with tests
4. Run `mise run check`
5. Submit PR with clear description

### Commit Messages

Follow conventional commits:
- `feat: Add new tool for X`
- `fix: Handle edge case in search`
- `docs: Update installation guide`
- `test: Add fuzz tests for parser`

### Code Review

PRs are reviewed for:
- Correctness
- Test coverage
- Documentation
- Performance
- Security

## Getting Help

- **Issues**: [GitHub Issues](https://github.com/zach-snell/bbkt/issues)
- **Discussions**: [GitHub Discussions](https://github.com/zach-snell/bbkt/discussions)
